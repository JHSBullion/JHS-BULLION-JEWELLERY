<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JHS BULLION & JEWELLERY</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <h1>JHS BULLION & JEWELLERY</h1>
    <p class="subtitle">马来西亚黄金金价展示网站</p>
    <h2>黄金金价表</h2>
    <table>
      <thead>
        <tr><th>类型</th><th>MYR / 克</th><th>趋势</th></tr>
      </thead>
      <tbody>
        <tr><td>999 Gold</td><td id="p999">--</td><td id="t999">--</td></tr>
        <tr><td>916 Gold</td><td id="p916">--</td><td id="t916">--</td></tr>
        <tr><td>835 Gold</td><td id="p835">--</td><td id="t835">--</td></tr>
        <tr><td>750 Gold</td><td id="p750">--</td><td id="t750">--</td></tr>
        <tr><td>375 Gold</td><td id="p375">--</td><td id="t375">--</td></tr>
      </tbody>
    </table>
    <canvas id="goldChart" width="400" height="200" style="margin-top:30px;"></canvas>
    <div style="text-align:center; margin-top:10px;">
      <span style="color:#d4af37;font-weight:bold;">● 999 Gold</span>
      &nbsp;&nbsp;&nbsp;
      <span style="color:#ff8800;font-weight:bold;">● 916 Gold</span>
    </div>
    <p id="updateDate">今日更新：--</p>
  </div>

  <script src="js/data.js"></script>
  <script>
    const data = window.goldPrices || {};
    const today = new Date().toISOString().slice(0, 10);
    document.getElementById("updateDate").textContent = "今日更新：" + today;

    const updatePrice = (id, price, diff) => {
      document.getElementById("p"+id).textContent = price ?? "--";
      const trend = document.getElementById("t"+id);
      if (diff > 0) trend.innerHTML = `<span style='color:green'>▲ ${diff}</span>`;
      else if (diff < 0) trend.innerHTML = `<span style='color:red'>▼ ${Math.abs(diff)}</span>`;
      else trend.textContent = "--";
    };

    ["999","916","835","750","375"].forEach(id => {
      const d = data[id];
      updatePrice(id, d?.current, d?.diff);
    });

    function getLast7Days() {
      const days = [];
      for (let i = 6; i >= 0; i--) {
        const d = new Date();
        d.setDate(d.getDate() - i);
        days.push(d.toISOString().slice(5, 10)); // MM-DD
      }
      return days;
    }

    const days = getLast7Days();
    const prices999 = (data["999"]?.history || []).slice(0, 7);
    const prices916 = (data["916"]?.history || []).slice(0, 7);

    const ctx = document.getElementById("goldChart").getContext("2d");
    new Chart(ctx, {
      type: "line",
      data: {
        labels: days,
        datasets: [
          {
            label: "999 Gold",
            data: prices999,
            borderColor: "#d4af37",
            backgroundColor: "#d4af37",
            fill: false,
            tension: 0.3
          },
          {
            label: "916 Gold",
            data: prices916,
            borderColor: "#ff8800",
            backgroundColor: "#ff8800",
            fill: false,
            tension: 0.3
          }
        ]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: false } }
      }
    });
  </script>
</body>
</html>
