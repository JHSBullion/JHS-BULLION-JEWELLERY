<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JHS BULLION & JEWELLERY</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
  <div class="container">
    <h1>JHS BULLION & JEWELLERY</h1>
    <p class="subtitle">马来西亚黄金金价展示网站</p>
    <h2>全马收金最高价</h2>

    <table>
      <thead>
        <tr>
          <th>类型</th>
          <th>MYR / 克（门店价）</th>
          <th>趋势</th>
        </tr>
      </thead>
      <tbody id="priceTable">
        <tr><td>999.9 BAR(P)</td><td id="p9999P">--</td><td id="t9999P">--</td></tr>
        <tr><td>999.9 BAR</td><td id="p9999">--</td><td id="t9999">--</td></tr>
        <tr><td>999 GOLD</td><td id="p999">--</td><td id="t999">--</td></tr>
        <tr><td>916 GOLD</td><td id="p916">--</td><td id="t916">--</td></tr>
        <tr><td>835 GOLD</td><td id="p835">--</td><td id="t835">--</td></tr>
      </tbody>
    </table>

    <canvas id="goldChart" width="400" height="200" style="margin-top: 40px;"></canvas>
    <div style="text-align: center; margin-top: 10px;">
      <span style="color:#d4af37; font-weight:bold;">● 999 Gold</span>
      &nbsp;&nbsp;&nbsp;
      <span style="color:#ff8800; font-weight:bold;">● 916 Gold</span>
    </div>

    <p id="updateDate">今日更新：--</p>

    <div class="whatsapp">
      <button onclick="window.open('https://wa.me/601154021213', '_blank')">WhatsApp 咨询</button>
    </div>

    <footer>
      <div>JHS JEWELLERY SDN BHD. 07-3511104</div>
      <div><a href="https://www.jhsbullion.com" style="color: #b88c00; text-decoration: none;">www.jhsbullion.com</a></div>
      <div class="social">
        <a href="https://www.facebook.com/share/17GxKng5DB/?mibextid=wwXIfr" target="_blank"><i class="fab fa-facebook-f"></i></a>
        <a href="https://www.instagram.com/jhs_bullion_and_jewellery" target="_blank"><i class="fab fa-instagram"></i></a>
      </div>
    </footer>
  </div>

  <!-- 动态加载 data.js（加时间戳，避免缓存） -->
  <script>
    function formatTime(d) {
      const pad = n => String(n).padStart(2, "0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    function loadData(callback) {
      const s = document.createElement("script");
      s.src = "js/data.js?v=" + Date.now();
      s.onload = () => { callback && callback(); s.remove(); };
      s.onerror = () => { console.warn("加载 data.js 失败"); s.remove(); };
      document.head.appendChild(s);
    }

    function render() {
      // ----- 表格：门店卖价 + 涨跌 -----
      const store = window.storePrices || {};
      const diffs = window.storeDiffs || {};
      const rows = [
        ["999.9 BAR(P)", "p9999P", "t9999P"],
        ["999.9 BAR",    "p9999",  "t9999"],
        ["999 GOLD",     "p999",   "t999"],
        ["916 GOLD",     "p916",   "t916"],
        ["835 GOLD",     "p835",   "t835"]
      ];

      for (const [label, priceId, trendId] of rows) {
        const priceCell = document.getElementById(priceId);
        const trendCell = document.getElementById(trendId);
        const price = store[label];
        priceCell.textContent = (price == null) ? "--" : String(price);

        const d = diffs[label];
        trendCell.innerHTML =
          d == null ? "--" :
          d > 0 ? `<span style="color:green">▲ ${d}</span>` :
          d < 0 ? `<span style="color:red">▼ ${Math.abs(d)}</span>` :
          `<span style="color:#aaa">— 0</span>`;
      }

      // ----- “今日更新”显示到分钟 -----
      document.getElementById("updateDate").textContent =
        "今日更新：" + formatTime(new Date()) + " （来自 GoldAPI）";

      // ----- 折线图：使用市场价历史 goldPrices -----
      const data = window.goldPrices || {};
      function seriesOf(key) {
        const hist = (data[key] && Array.isArray(data[key].history)) ? data[key].history : [];
        return {
          labels: hist.map(it => (it.date || "").slice(5)), // MM-DD
          values: hist.map(it => it.value)
        };
      }
      const chart999 = seriesOf("999");
      const chart916 = seriesOf("916");

      const ctx = document.getElementById("goldChart").getContext("2d");
      new Chart(ctx, {
        type: "line",
        data: {
          labels: chart999.labels,
          datasets: [
            {
              label: "999 GOLD",
              data: chart999.values,
              borderColor: "#d4af37",
              backgroundColor: "#d4af37",
              fill: false,
              tension: 0.3
            },
            {
              label: "916 GOLD",
              data: chart916.values,
              borderColor: "#ff8800",
              backgroundColor: "#ff8800",
              fill: false,
              tension: 0.3
            }
          ]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: false } }
        }
      });
    }

    // 首次加载并渲染
    loadData(render);

    // 每 15 分钟自动刷新整页（按需可改：单位毫秒）
    setInterval(() => location.reload(), 15 * 60 * 1000);
  </script>
</body>
</html>
